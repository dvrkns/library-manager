<template>
  <div class="home">
    <div class="hero-section card mb-3">
      <h1 class="hero-title">–ú–µ–Ω–µ–¥–∂–µ—Ä –±–∏–±–ª–∏–æ—Ç–µ–∫ –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ–≥–æ –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è</h1>
      <p class="hero-description">
        –ù–∞—à–∞ —Å–∏—Å—Ç–µ–º–∞ –ø–æ–º–æ–≥–∞–µ—Ç —É–ø—Ä–∞–≤–ª—è—Ç—å –ø—Ä–æ–≥—Ä–∞–º–º–Ω—ã–º–∏ –±–∏–±–ª–∏–æ—Ç–µ–∫–∞–º–∏ –∏ –ø–∞–∫–µ—Ç–∞–º–∏. –•—Ä–∞–Ω–∏—Ç–µ, —Å–∏—Å—Ç–µ–º–∞—Ç–∏–∑–∏—Ä—É–π—Ç–µ 
        –∏ –Ω–∞—Ö–æ–¥–∏—Ç–µ –Ω—É–∂–Ω—ã–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –¥–ª—è —Å–≤–æ–∏—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤. –í—ã –º–æ–∂–µ—Ç–µ –∏—Å–∫–∞—Ç—å –ø–∞–∫–µ—Ç—ã –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é, 
        –≤–µ—Ä—Å–∏–∏ –∏ –¥—Ä—É–≥–∏–º –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º, –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –¥–µ—Ç–∞–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –∏ –∑–∞–≥—Ä—É–∂–∞—Ç—å –±–∏–±–ª–∏–æ—Ç–µ–∫–∏.
      </p>
      <div class="features-list">
        <div class="feature-item">
          <i class="feature-icon">üîç</i>
          <h3>–ë—ã—Å—Ç—Ä—ã–π –ø–æ–∏—Å–∫</h3>
          <p>–ú–≥–Ω–æ–≤–µ–Ω–Ω–æ –Ω–∞—Ö–æ–¥–∏—Ç–µ –Ω—É–∂–Ω—ã–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é, –≤–µ—Ä—Å–∏–∏ –∏–ª–∏ –¥–∞—Ç–µ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏</p>
        </div>
        <div class="feature-item">
          <i class="feature-icon">üì¶</i>
          <h3>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–∞–∫–µ—Ç–∞–º–∏</h3>
          <p>–£–¥–æ–±–Ω–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ, —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –∫–∞—Ç–∞–ª–æ–≥–∏–∑–∞—Ü–∏—è –ø—Ä–æ–≥—Ä–∞–º–º–Ω—ã—Ö –±–∏–±–ª–∏–æ—Ç–µ–∫</p>
        </div>
        <div class="feature-item">
          <i class="feature-icon">‚¨áÔ∏è</i>
          <h3>–ó–∞–≥—Ä—É–∑–∫–∞ –±–∏–±–ª–∏–æ—Ç–µ–∫</h3>
          <p>–°–∫–∞—á–∏–≤–∞–π—Ç–µ –Ω—É–∂–Ω—ã–µ –ø–∞–∫–µ—Ç—ã –ø—Ä—è–º–æ –∏–∑ –∫–∞—Ç–∞–ª–æ–≥–∞ –æ–¥–Ω–∏–º –∫–ª–∏–∫–æ–º</p>
        </div>
      </div>
    </div>
    
    <SearchBar 
      @search-performed="searchPerformed = true"
      :showSortingOptions="searchPerformed && !loading && libraryGroups.length > 0"
    />
    
    <div v-if="notification" class="notification" :class="notification.type">
      {{ notification.message }}
      <button class="close-btn" @click="clearNotification">&times;</button>
    </div>
    
    <!-- –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å —Ä–∞–∑–¥–µ–ª –±–∏–±–ª–∏–æ—Ç–µ–∫ —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –ø–æ–∏—Å–∫–∞ -->
    <div v-if="searchPerformed" class="libraries-section">
      <div class="page-header mt-4">
        <h2 class="section-title">–ë–∏–±–ª–∏–æ—Ç–µ–∫–∏</h2>
      </div>
      
      <div v-if="loading" class="loading-container">
        <p>–ó–∞–≥—Ä—É–∑–∫–∞ –±–∏–±–ª–∏–æ—Ç–µ–∫...</p>
      </div>
      
      <div v-else-if="error" class="error-container">
        <p class="error-message">{{ error }}</p>
      </div>
      
      <div v-else-if="libraryGroups.length === 0" class="empty-container">
        <p>–ë–∏–±–ª–∏–æ—Ç–µ–∫–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–∏—Å–∫–∞.</p>
      </div>
      
      <div v-else class="libraries-list">
        <div v-for="group in libraryGroups" :key="group.name" class="library-group">
          <LibraryListItem 
            :library="group.latest" 
            :versions="group.versions"
          />
        </div>
      </div>
    </div>
  </div>
</template>

<script setup>
import { onMounted, computed, ref, watch } from 'vue';
import { useRoute } from 'vue-router';
import { useLibrariesStore } from '@/stores/libraries';
import SearchBar from '@/components/SearchBar.vue';
import LibraryListItem from '@/components/LibraryListItem.vue';

const store = useLibrariesStore();
const route = useRoute();

// –§–ª–∞–≥, —É–∫–∞–∑—ã–≤–∞—é—â–∏–π, –±—ã–ª –ª–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω –ø–æ–∏—Å–∫
const searchPerformed = ref(false);
const libraries = ref([]);

// Computed properties
const loading = computed(() => store.loading);
const error = computed(() => store.error);

// –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –±–∏–±–ª–∏–æ—Ç–µ–∫ –ø–æ –∏–º–µ–Ω–∏ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤–µ—Ä—Å–∏–π
const libraryGroups = computed(() => {
  // –ì—Ä—É–ø–ø–∏—Ä—É–µ–º –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –ø–æ –∏–º–µ–Ω–∏
  const groups = {};
  libraries.value.forEach(lib => {
    if (!groups[lib.name]) {
      groups[lib.name] = { 
        name: lib.name, 
        versions: [], 
        latest: lib 
      };
    }
    
    groups[lib.name].versions.push(lib);
    
    // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –ø–æ—Å–ª–µ–¥–Ω—é—é –≤–µ—Ä—Å–∏—é
    if (new Date(lib.published_date) > new Date(groups[lib.name].latest.published_date)) {
      groups[lib.name].latest = lib;
    }
  });
  
  // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –≤ –º–∞—Å—Å–∏–≤ –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º
  return Object.values(groups);
});

// Notification system
const notification = ref(null);

// Check for query parameters to show notification
onMounted(() => {
  if (route.query.message) {
    notification.value = {
      message: route.query.message,
      type: route.query.type || 'info'
    };
    
    // Auto-hide notification after 5 seconds
    setTimeout(() => {
      clearNotification();
    }, 5000);
  }
  
  // –ï—Å–ª–∏ –≤ URL –µ—Å—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä –ø–æ–∏—Å–∫–∞, —Å—á–∏—Ç–∞–µ–º —á—Ç–æ –ø–æ–∏—Å–∫ –±—ã–ª –≤—ã–ø–æ–ª–Ω–µ–Ω
  if (route.query.q) {
    searchPerformed.value = true;
  }
});

const clearNotification = () => {
  notification.value = null;
};

// –û—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –∏ –æ–±–Ω–æ–≤–ª—è–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–π –º–∞—Å—Å–∏–≤ –±–∏–±–ª–∏–æ—Ç–µ–∫
watch(() => store.libraries, (newLibraries) => {
  libraries.value = newLibraries;
});

// Load libraries only if there's a search query
onMounted(async () => {
  if (route.query.q) {
    store.setSearchQuery(route.query.q);
    store.setSortBy(route.query.sort || '-published_date');
    await store.searchLibraries();
    libraries.value = store.libraries;
    searchPerformed.value = true;
  }
});
</script>

<style scoped>
.hero-section {
  text-align: center;
  padding: 2.5rem;
  background: linear-gradient(135deg, #f5f7ff 0%, #e3e8ff 100%);
  border-radius: 12px;
  margin-bottom: 2rem;
}

.hero-title {
  font-size: 2.5rem;
  margin-bottom: 1rem;
  color: var(--primary-color);
}

.hero-description {
  font-size: 1.1rem;
  margin-bottom: 2rem;
  max-width: 800px;
  margin-left: auto;
  margin-right: auto;
  line-height: 1.6;
}

.features-list {
  display: flex;
  justify-content: space-around;
  gap: 2rem;
  margin-top: 2rem;
}

.feature-item {
  flex: 1;
  padding: 1.5rem;
  background-color: white;
  border-radius: 8px;
  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
  transition: transform 0.3s, box-shadow 0.3s;
}

.feature-item:hover {
  transform: translateY(-5px);
  box-shadow: 0 6px 15px rgba(0, 0, 0, 0.1);
}

.feature-icon {
  font-size: 2rem;
  display: block;
  margin-bottom: 1rem;
}

.feature-item h3 {
  margin-bottom: 0.5rem;
  color: var(--primary-color);
}

.section-title {
  font-size: 1.75rem;
  margin-bottom: 0;
}

.page-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 1.5rem;
}

.libraries-section {
  animation: fadeIn 0.5s ease-in-out;
}

.libraries-list {
  display: flex;
  flex-direction: column;
  gap: 1rem;
}

.btn {
  padding: 0.75rem 1.5rem;
  border: none;
  border-radius: 4px;
  font-size: 1rem;
  cursor: pointer;
  transition: background-color 0.3s;
  text-decoration: none;
}

.btn.primary {
  background-color: var(--primary-color);
  color: white;
}

.btn.primary:hover {
  background-color: #3050d8;
}

.notification {
  position: relative;
  padding: 1rem;
  margin-bottom: 1.5rem;
  border-radius: 4px;
  animation: fadeIn 0.3s ease-in-out;
}

.notification.success {
  background-color: #e8f5e9;
  color: #2e7d32;
}

.notification.error {
  background-color: #ffebee;
  color: #c62828;
}

.notification.info {
  background-color: #e3f2fd;
  color: #1565c0;
}

.close-btn {
  position: absolute;
  top: 0.5rem;
  right: 0.5rem;
  background: none;
  border: none;
  font-size: 1.25rem;
  cursor: pointer;
  opacity: 0.7;
}

.close-btn:hover {
  opacity: 1;
}

.loading-container,
.error-container,
.empty-container {
  padding: 2rem;
  text-align: center;
  background: white;
  border-radius: 8px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
}

.error-message {
  color: #c62828;
}

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(10px); }
  to { opacity: 1; transform: translateY(0); }
}

@media (max-width: 768px) {
  .features-list {
    flex-direction: column;
    gap: 1rem;
  }
}
</style> 